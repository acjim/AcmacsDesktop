/*
	Antigenic Cartography for Desktop
	[Antigenic Cartography](http://www.antigenic-cartography.org/) is the process of creating maps of antigenically variable pathogens. 
	In some cases two-dimensional maps can be produced which reveal interesting information about the antigenic evolution of a pathogen.
	This project aims at providing a desktop application for working with antigenic maps.

	Â© 2015 The Antigenic Cartography Group at the University of Cambridge

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
'use strict';

var app = angular.module('acjim.filehandling',[]);
var config = require('./config.js');

app.controller('filehandlingCtrl', ['$scope', 'fileDialog', function($scope, fileDialog) {
    $scope.fileContent = "";

    $scope.showTable = true;

    $scope.$on('new-file', function(e, menu, item) {
        $scope.openMaps.push( { title:'New Map '+$scope.openMaps.length, content:'Dynamic content '+$scope.openMaps.length, active: true } );
        $scope.$apply();
    });

    $scope.$on('open-file', function(e, menu, item) {
        fileDialog.openFile($scope.handleFileOpen, false, '.xls,.xlsx,.txt,.save,.acd1,.acd1.bz2,.acd1.xz,.acp1,.acp1.bz2,.acp1.xz');
    });

    $scope.$on('save-file', function(e, menu, item) {
        var filename = 'new.save';

        $scope.openMaps.forEach(function(map, index){
            if(map.active) filename = map.title;
        });
        fileDialog.saveAs($scope.handleFileSave, filename, '.xls,.xlsx,.txt,.save,.acd1,.acd1.bz2,.acd1.xz,.acp1,.acp1.bz2,.acp1.xz');
    });

    $scope.$on('close-file', function(e, menu, item) {
        $scope.openMaps.forEach(function(map, index){
           if(map.active) $scope.openMaps.splice(index, 1);
        });
        $scope.$apply();
    });

    $scope.openMaps = [
        {title:"Sample Map 1", table: {
            "info":{
                "assay":"HI",
                "date":"2010-03-12",
                "influenza":{
                    "rbc_species":"turkey",
                    "virus_type":"A"
                },
                "lab":"EU",
                "name":"concentric-circles",
                "virus":"influenza"
            },
            "table":{
                "antigens":[
                    {
                        "name":"A1",
                        "reference":1
                    },
                    {
                        "name":"A2",
                        "reference":1
                    },
                    {
                        "name":"A3",
                        "reference":1
                    },
                    {
                        "name":"A4",
                        "reference":1
                    },
                    {
                        "name":"A5",
                        "reference":1
                    },
                    {
                        "name":"A6",
                        "reference":1
                    },
                    {
                        "name":"A7",
                        "reference":1
                    },
                    {
                        "name":"A8",
                        "reference":1
                    },
                    {
                        "name":"A9",
                        "reference":1
                    },
                    {
                        "name":"A10",
                        "reference":1
                    },
                    {
                        "name":"A11",
                        "reference":1
                    },
                    {
                        "name":"A12",
                        "reference":1
                    },
                    {
                        "name":"A13",
                        "reference":1
                    },
                    {
                        "name":"A14",
                        "reference":1
                    },
                    {
                        "name":"A15",
                        "reference":1
                    },
                    {
                        "name":"A16",
                        "reference":1
                    },
                    {
                        "name":"A17",
                        "reference":1
                    },
                    {
                        "name":"A18",
                        "reference":1
                    },
                    {
                        "name":"A19",
                        "reference":1
                    },
                    {
                        "name":"A20",
                        "reference":1
                    },
                    {
                        "name":"A21",
                        "reference":1
                    },
                    {
                        "name":"A22",
                        "reference":1
                    },
                    {
                        "name":"A23",
                        "reference":1
                    },
                    {
                        "name":"A24",
                        "reference":1
                    },
                    {
                        "name":"A25",
                        "reference":1
                    },
                    {
                        "name":"A26",
                        "reference":1
                    },
                    {
                        "name":"A27",
                        "reference":1
                    },
                    {
                        "name":"A28",
                        "reference":1
                    },
                    {
                        "name":"A29",
                        "reference":1
                    },
                    {
                        "name":"A30",
                        "reference":1
                    },
                    {
                        "name":"A31",
                        "reference":1
                    },
                    {
                        "name":"A32",
                        "reference":1
                    },
                    {
                        "name":"A33",
                        "reference":1
                    },
                    {
                        "name":"A34",
                        "reference":1
                    },
                    {
                        "name":"A35",
                        "reference":1
                    }
                ],
                "names_unmodifiable":true,
                "sera":[
                    {
                        "name":"S1"
                    },
                    {
                        "name":"S2"
                    },
                    {
                        "name":"S3"
                    },
                    {
                        "name":"S4"
                    },
                    {
                        "name":"S5"
                    },
                    {
                        "name":"S6"
                    },
                    {
                        "name":"S7"
                    },
                    {
                        "name":"S8"
                    },
                    {
                        "name":"S9"
                    },
                    {
                        "name":"S10"
                    },
                    {
                        "name":"S11"
                    },
                    {
                        "name":"S12"
                    },
                    {
                        "name":"S13"
                    },
                    {
                        "name":"S14"
                    },
                    {
                        "name":"S15"
                    },
                    {
                        "name":"S16"
                    },
                    {
                        "name":"S17"
                    },
                    {
                        "name":"S18"
                    },
                    {
                        "name":"S19"
                    },
                    {
                        "name":"S20"
                    },
                    {
                        "name":"S21"
                    },
                    {
                        "name":"S22"
                    },
                    {
                        "name":"S23"
                    },
                    {
                        "name":"S24"
                    },
                    {
                        "name":"S25"
                    },
                    {
                        "name":"S26"
                    },
                    {
                        "name":"S27"
                    },
                    {
                        "name":"S28"
                    },
                    {
                        "name":"S29"
                    },
                    {
                        "name":"S30"
                    },
                    {
                        "name":"S31"
                    },
                    {
                        "name":"S32"
                    },
                    {
                        "name":"S33"
                    },
                    {
                        "name":"S34"
                    },
                    {
                        "name":"S35"
                    }
                ],
                "titers":{
                    "number_of_layers":0,
                    "titers_list_of_dict":[
                        {
                            "0":"1280",
                            "1":"640",
                            "2":"640",
                            "3":"320",
                            "4":"160",
                            "5":"160",
                            "6":"80",
                            "7":"80",
                            "8":"40",
                            "9":"40",
                            "10":"40",
                            "11":"40",
                            "12":"40",
                            "13":"80",
                            "14":"80",
                            "15":"160",
                            "16":"160",
                            "17":"320",
                            "18":"640",
                            "19":"640",
                            "20":"640",
                            "21":"320",
                            "22":"320",
                            "23":"160",
                            "24":"80",
                            "25":"80",
                            "26":"80",
                            "27":"160",
                            "28":"320",
                            "29":"320",
                            "30":"320",
                            "31":"320",
                            "32":"160",
                            "33":"160",
                            "34":"320"
                        },
                        {
                            "0":"640",
                            "1":"1280",
                            "2":"640",
                            "3":"640",
                            "4":"320",
                            "5":"160",
                            "6":"160",
                            "7":"80",
                            "8":"80",
                            "9":"40",
                            "10":"40",
                            "11":"40",
                            "12":"40",
                            "13":"40",
                            "14":"80",
                            "15":"80",
                            "16":"160",
                            "17":"160",
                            "18":"320",
                            "19":"640",
                            "20":"640",
                            "21":"640",
                            "22":"320",
                            "23":"160",
                            "24":"160",
                            "25":"80",
                            "26":"80",
                            "27":"160",
                            "28":"160",
                            "29":"320",
                            "30":"320",
                            "31":"320",
                            "32":"160",
                            "33":"160",
                            "34":"320"
                        },
                        {
                            "0":"640",
                            "1":"640",
                            "2":"1280",
                            "3":"640",
                            "4":"640",
                            "5":"320",
                            "6":"160",
                            "7":"160",
                            "8":"80",
                            "9":"80",
                            "10":"40",
                            "11":"40",
                            "12":"40",
                            "13":"40",
                            "14":"40",
                            "15":"80",
                            "16":"80",
                            "17":"160",
                            "18":"160",
                            "19":"320",
                            "20":"320",
                            "21":"640",
                            "22":"320",
                            "23":"320",
                            "24":"160",
                            "25":"80",
                            "26":"80",
                            "27":"80",
                            "28":"160",
                            "29":"320",
                            "30":"320",
                            "31":"320",
                            "32":"160",
                            "33":"160",
                            "34":"160"
                        },
                        {
                            "0":"320",
                            "1":"640",
                            "2":"640",
                            "3":"1280",
                            "4":"640",
                            "5":"640",
                            "6":"320",
                            "7":"160",
                            "8":"160",
                            "9":"80",
                            "10":"80",
                            "11":"40",
                            "12":"40",
                            "13":"40",
                            "14":"40",
                            "15":"40",
                            "16":"80",
                            "17":"80",
                            "18":"160",
                            "19":"160",
                            "20":"320",
                            "21":"640",
                            "22":"640",
                            "23":"320",
                            "24":"160",
                            "25":"160",
                            "26":"80",
                            "27":"80",
                            "28":"160",
                            "29":"160",
                            "30":"320",
                            "31":"320",
                            "32":"320",
                            "33":"160",
                            "34":"160"
                        },
                        {
                            "0":"160",
                            "1":"320",
                            "2":"640",
                            "3":"640",
                            "4":"1280",
                            "5":"640",
                            "6":"640",
                            "7":"320",
                            "8":"160",
                            "9":"160",
                            "10":"80",
                            "11":"80",
                            "12":"40",
                            "13":"40",
                            "14":"40",
                            "15":"40",
                            "16":"40",
                            "17":"80",
                            "18":"80",
                            "19":"160",
                            "20":"320",
                            "21":"320",
                            "22":"640",
                            "23":"320",
                            "24":"320",
                            "25":"160",
                            "26":"80",
                            "27":"80",
                            "28":"80",
                            "29":"160",
                            "30":"320",
                            "31":"320",
                            "32":"320",
                            "33":"160",
                            "34":"160"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"320",
                            "3":"640",
                            "4":"640",
                            "5":"1280",
                            "6":"640",
                            "7":"640",
                            "8":"320",
                            "9":"160",
                            "10":"160",
                            "11":"80",
                            "12":"80",
                            "13":"40",
                            "14":"40",
                            "15":"40",
                            "16":"40",
                            "17":"40",
                            "18":"80",
                            "19":"80",
                            "20":"160",
                            "21":"320",
                            "22":"640",
                            "23":"640",
                            "24":"320",
                            "25":"160",
                            "26":"160",
                            "27":"80",
                            "28":"80",
                            "29":"160",
                            "30":"320",
                            "31":"320",
                            "32":"320",
                            "33":"160",
                            "34":"160"
                        },
                        {
                            "0":"80",
                            "1":"160",
                            "2":"160",
                            "3":"320",
                            "4":"640",
                            "5":"640",
                            "6":"1280",
                            "7":"640",
                            "8":"640",
                            "9":"320",
                            "10":"160",
                            "11":"160",
                            "12":"80",
                            "13":"80",
                            "14":"40",
                            "15":"40",
                            "16":"40",
                            "17":"40",
                            "18":"40",
                            "19":"80",
                            "20":"160",
                            "21":"320",
                            "22":"320",
                            "23":"640",
                            "24":"320",
                            "25":"320",
                            "26":"160",
                            "27":"80",
                            "28":"80",
                            "29":"80",
                            "30":"160",
                            "31":"320",
                            "32":"320",
                            "33":"160",
                            "34":"160"
                        },
                        {
                            "0":"80",
                            "1":"80",
                            "2":"160",
                            "3":"160",
                            "4":"320",
                            "5":"640",
                            "6":"640",
                            "7":"1280",
                            "8":"640",
                            "9":"640",
                            "10":"320",
                            "11":"160",
                            "12":"160",
                            "13":"80",
                            "14":"80",
                            "15":"40",
                            "16":"40",
                            "17":"40",
                            "18":"40",
                            "19":"40",
                            "20":"160",
                            "21":"160",
                            "22":"320",
                            "23":"640",
                            "24":"640",
                            "25":"320",
                            "26":"160",
                            "27":"160",
                            "28":"80",
                            "29":"80",
                            "30":"160",
                            "31":"320",
                            "32":"320",
                            "33":"320",
                            "34":"160"
                        },
                        {
                            "0":"40",
                            "1":"80",
                            "2":"80",
                            "3":"160",
                            "4":"160",
                            "5":"320",
                            "6":"640",
                            "7":"640",
                            "8":"1280",
                            "9":"640",
                            "10":"640",
                            "11":"320",
                            "12":"160",
                            "13":"160",
                            "14":"80",
                            "15":"80",
                            "16":"40",
                            "17":"40",
                            "18":"40",
                            "19":"40",
                            "20":"80",
                            "21":"160",
                            "22":"320",
                            "23":"320",
                            "24":"640",
                            "25":"320",
                            "26":"320",
                            "27":"160",
                            "28":"80",
                            "29":"80",
                            "30":"160",
                            "31":"320",
                            "32":"320",
                            "33":"320",
                            "34":"160"
                        },
                        {
                            "0":"40",
                            "1":"40",
                            "2":"80",
                            "3":"80",
                            "4":"160",
                            "5":"160",
                            "6":"320",
                            "7":"640",
                            "8":"640",
                            "9":"1280",
                            "10":"640",
                            "11":"640",
                            "12":"320",
                            "13":"160",
                            "14":"160",
                            "15":"80",
                            "16":"80",
                            "17":"40",
                            "18":"40",
                            "19":"40",
                            "20":"80",
                            "21":"160",
                            "22":"160",
                            "23":"320",
                            "24":"640",
                            "25":"640",
                            "26":"320",
                            "27":"160",
                            "28":"160",
                            "29":"80",
                            "30":"160",
                            "31":"320",
                            "32":"320",
                            "33":"320",
                            "34":"160"
                        },
                        {
                            "0":"40",
                            "1":"40",
                            "2":"40",
                            "3":"80",
                            "4":"80",
                            "5":"160",
                            "6":"160",
                            "7":"320",
                            "8":"640",
                            "9":"640",
                            "10":"1280",
                            "11":"640",
                            "12":"640",
                            "13":"320",
                            "14":"160",
                            "15":"160",
                            "16":"80",
                            "17":"80",
                            "18":"40",
                            "19":"40",
                            "20":"80",
                            "21":"80",
                            "22":"160",
                            "23":"320",
                            "24":"320",
                            "25":"640",
                            "26":"320",
                            "27":"320",
                            "28":"160",
                            "29":"80",
                            "30":"160",
                            "31":"160",
                            "32":"320",
                            "33":"320",
                            "34":"160"
                        },
                        {
                            "0":"40",
                            "1":"40",
                            "2":"40",
                            "3":"40",
                            "4":"80",
                            "5":"80",
                            "6":"160",
                            "7":"160",
                            "8":"320",
                            "9":"640",
                            "10":"640",
                            "11":"1280",
                            "12":"640",
                            "13":"640",
                            "14":"320",
                            "15":"160",
                            "16":"160",
                            "17":"80",
                            "18":"80",
                            "19":"40",
                            "20":"80",
                            "21":"80",
                            "22":"160",
                            "23":"160",
                            "24":"320",
                            "25":"640",
                            "26":"640",
                            "27":"320",
                            "28":"160",
                            "29":"160",
                            "30":"160",
                            "31":"160",
                            "32":"320",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"40",
                            "1":"40",
                            "2":"40",
                            "3":"40",
                            "4":"40",
                            "5":"80",
                            "6":"80",
                            "7":"160",
                            "8":"160",
                            "9":"320",
                            "10":"640",
                            "11":"640",
                            "12":"1280",
                            "13":"640",
                            "14":"640",
                            "15":"320",
                            "16":"160",
                            "17":"160",
                            "18":"80",
                            "19":"80",
                            "20":"80",
                            "21":"80",
                            "22":"80",
                            "23":"160",
                            "24":"320",
                            "25":"320",
                            "26":"640",
                            "27":"320",
                            "28":"320",
                            "29":"160",
                            "30":"160",
                            "31":"160",
                            "32":"320",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"80",
                            "1":"40",
                            "2":"40",
                            "3":"40",
                            "4":"40",
                            "5":"40",
                            "6":"80",
                            "7":"80",
                            "8":"160",
                            "9":"160",
                            "10":"320",
                            "11":"640",
                            "12":"640",
                            "13":"1280",
                            "14":"640",
                            "15":"640",
                            "16":"320",
                            "17":"160",
                            "18":"160",
                            "19":"80",
                            "20":"160",
                            "21":"80",
                            "22":"80",
                            "23":"160",
                            "24":"160",
                            "25":"320",
                            "26":"640",
                            "27":"640",
                            "28":"320",
                            "29":"160",
                            "30":"160",
                            "31":"160",
                            "32":"320",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"80",
                            "1":"80",
                            "2":"40",
                            "3":"40",
                            "4":"40",
                            "5":"40",
                            "6":"40",
                            "7":"80",
                            "8":"80",
                            "9":"160",
                            "10":"160",
                            "11":"320",
                            "12":"640",
                            "13":"640",
                            "14":"1280",
                            "15":"640",
                            "16":"640",
                            "17":"320",
                            "18":"160",
                            "19":"160",
                            "20":"160",
                            "21":"80",
                            "22":"80",
                            "23":"80",
                            "24":"160",
                            "25":"320",
                            "26":"320",
                            "27":"640",
                            "28":"320",
                            "29":"320",
                            "30":"160",
                            "31":"160",
                            "32":"160",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"160",
                            "1":"80",
                            "2":"80",
                            "3":"40",
                            "4":"40",
                            "5":"40",
                            "6":"40",
                            "7":"40",
                            "8":"80",
                            "9":"80",
                            "10":"160",
                            "11":"160",
                            "12":"320",
                            "13":"640",
                            "14":"640",
                            "15":"1280",
                            "16":"640",
                            "17":"640",
                            "18":"320",
                            "19":"160",
                            "20":"160",
                            "21":"160",
                            "22":"80",
                            "23":"80",
                            "24":"160",
                            "25":"160",
                            "26":"320",
                            "27":"640",
                            "28":"640",
                            "29":"320",
                            "30":"320",
                            "31":"160",
                            "32":"160",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"80",
                            "3":"80",
                            "4":"40",
                            "5":"40",
                            "6":"40",
                            "7":"40",
                            "8":"40",
                            "9":"80",
                            "10":"80",
                            "11":"160",
                            "12":"160",
                            "13":"320",
                            "14":"640",
                            "15":"640",
                            "16":"1280",
                            "17":"640",
                            "18":"640",
                            "19":"320",
                            "20":"320",
                            "21":"160",
                            "22":"80",
                            "23":"80",
                            "24":"80",
                            "25":"160",
                            "26":"320",
                            "27":"320",
                            "28":"640",
                            "29":"320",
                            "30":"320",
                            "31":"160",
                            "32":"160",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"320",
                            "1":"160",
                            "2":"160",
                            "3":"80",
                            "4":"80",
                            "5":"40",
                            "6":"40",
                            "7":"40",
                            "8":"40",
                            "9":"40",
                            "10":"80",
                            "11":"80",
                            "12":"160",
                            "13":"160",
                            "14":"320",
                            "15":"640",
                            "16":"640",
                            "17":"1280",
                            "18":"640",
                            "19":"640",
                            "20":"320",
                            "21":"160",
                            "22":"160",
                            "23":"80",
                            "24":"80",
                            "25":"160",
                            "26":"160",
                            "27":"320",
                            "28":"640",
                            "29":"640",
                            "30":"320",
                            "31":"160",
                            "32":"160",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"640",
                            "1":"320",
                            "2":"160",
                            "3":"160",
                            "4":"80",
                            "5":"80",
                            "6":"40",
                            "7":"40",
                            "8":"40",
                            "9":"40",
                            "10":"40",
                            "11":"80",
                            "12":"80",
                            "13":"160",
                            "14":"160",
                            "15":"320",
                            "16":"640",
                            "17":"640",
                            "18":"1280",
                            "19":"640",
                            "20":"320",
                            "21":"320",
                            "22":"160",
                            "23":"80",
                            "24":"80",
                            "25":"80",
                            "26":"160",
                            "27":"320",
                            "28":"320",
                            "29":"640",
                            "30":"320",
                            "31":"160",
                            "32":"160",
                            "33":"160",
                            "34":"320"
                        },
                        {
                            "0":"640",
                            "1":"640",
                            "2":"320",
                            "3":"160",
                            "4":"160",
                            "5":"80",
                            "6":"80",
                            "7":"40",
                            "8":"40",
                            "9":"40",
                            "10":"40",
                            "11":"40",
                            "12":"80",
                            "13":"80",
                            "14":"160",
                            "15":"160",
                            "16":"320",
                            "17":"640",
                            "18":"640",
                            "19":"1280",
                            "20":"640",
                            "21":"320",
                            "22":"160",
                            "23":"160",
                            "24":"80",
                            "25":"80",
                            "26":"160",
                            "27":"160",
                            "28":"320",
                            "29":"640",
                            "30":"320",
                            "31":"320",
                            "32":"160",
                            "33":"160",
                            "34":"320"
                        },
                        {
                            "0":"640",
                            "1":"640",
                            "2":"320",
                            "3":"320",
                            "4":"320",
                            "5":"160",
                            "6":"160",
                            "7":"160",
                            "8":"80",
                            "9":"80",
                            "10":"80",
                            "11":"80",
                            "12":"80",
                            "13":"160",
                            "14":"160",
                            "15":"160",
                            "16":"320",
                            "17":"320",
                            "18":"320",
                            "19":"640",
                            "20":"1280",
                            "21":"640",
                            "22":"320",
                            "23":"320",
                            "24":"160",
                            "25":"160",
                            "26":"160",
                            "27":"320",
                            "28":"320",
                            "29":"640",
                            "30":"640",
                            "31":"640",
                            "32":"320",
                            "33":"320",
                            "34":"640"
                        },
                        {
                            "0":"320",
                            "1":"640",
                            "2":"640",
                            "3":"640",
                            "4":"320",
                            "5":"320",
                            "6":"320",
                            "7":"160",
                            "8":"160",
                            "9":"160",
                            "10":"80",
                            "11":"80",
                            "12":"80",
                            "13":"80",
                            "14":"80",
                            "15":"160",
                            "16":"160",
                            "17":"160",
                            "18":"320",
                            "19":"320",
                            "20":"640",
                            "21":"1280",
                            "22":"640",
                            "23":"320",
                            "24":"320",
                            "25":"160",
                            "26":"160",
                            "27":"160",
                            "28":"320",
                            "29":"320",
                            "30":"640",
                            "31":"640",
                            "32":"320",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"320",
                            "1":"320",
                            "2":"320",
                            "3":"640",
                            "4":"640",
                            "5":"640",
                            "6":"320",
                            "7":"320",
                            "8":"320",
                            "9":"160",
                            "10":"160",
                            "11":"160",
                            "12":"80",
                            "13":"80",
                            "14":"80",
                            "15":"80",
                            "16":"80",
                            "17":"160",
                            "18":"160",
                            "19":"160",
                            "20":"320",
                            "21":"640",
                            "22":"1280",
                            "23":"640",
                            "24":"320",
                            "25":"320",
                            "26":"160",
                            "27":"160",
                            "28":"160",
                            "29":"320",
                            "30":"640",
                            "31":"640",
                            "32":"640",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"320",
                            "3":"320",
                            "4":"320",
                            "5":"640",
                            "6":"640",
                            "7":"640",
                            "8":"320",
                            "9":"320",
                            "10":"320",
                            "11":"160",
                            "12":"160",
                            "13":"160",
                            "14":"80",
                            "15":"80",
                            "16":"80",
                            "17":"80",
                            "18":"80",
                            "19":"160",
                            "20":"320",
                            "21":"320",
                            "22":"640",
                            "23":"1280",
                            "24":"640",
                            "25":"320",
                            "26":"320",
                            "27":"160",
                            "28":"160",
                            "29":"160",
                            "30":"320",
                            "31":"640",
                            "32":"640",
                            "33":"320",
                            "34":"320"
                        },
                        {
                            "0":"80",
                            "1":"160",
                            "2":"160",
                            "3":"160",
                            "4":"320",
                            "5":"320",
                            "6":"320",
                            "7":"640",
                            "8":"640",
                            "9":"640",
                            "10":"320",
                            "11":"320",
                            "12":"320",
                            "13":"160",
                            "14":"160",
                            "15":"160",
                            "16":"80",
                            "17":"80",
                            "18":"80",
                            "19":"80",
                            "20":"160",
                            "21":"320",
                            "22":"320",
                            "23":"640",
                            "24":"1280",
                            "25":"640",
                            "26":"320",
                            "27":"320",
                            "28":"160",
                            "29":"160",
                            "30":"320",
                            "31":"640",
                            "32":"640",
                            "33":"640",
                            "34":"320"
                        },
                        {
                            "0":"80",
                            "1":"80",
                            "2":"80",
                            "3":"160",
                            "4":"160",
                            "5":"160",
                            "6":"320",
                            "7":"320",
                            "8":"320",
                            "9":"640",
                            "10":"640",
                            "11":"640",
                            "12":"320",
                            "13":"320",
                            "14":"320",
                            "15":"160",
                            "16":"160",
                            "17":"160",
                            "18":"80",
                            "19":"80",
                            "20":"160",
                            "21":"160",
                            "22":"320",
                            "23":"320",
                            "24":"640",
                            "25":"1280",
                            "26":"640",
                            "27":"320",
                            "28":"320",
                            "29":"160",
                            "30":"320",
                            "31":"320",
                            "32":"640",
                            "33":"640",
                            "34":"320"
                        },
                        {
                            "0":"80",
                            "1":"80",
                            "2":"80",
                            "3":"80",
                            "4":"80",
                            "5":"160",
                            "6":"160",
                            "7":"160",
                            "8":"320",
                            "9":"320",
                            "10":"320",
                            "11":"640",
                            "12":"640",
                            "13":"640",
                            "14":"320",
                            "15":"320",
                            "16":"320",
                            "17":"160",
                            "18":"160",
                            "19":"160",
                            "20":"160",
                            "21":"160",
                            "22":"160",
                            "23":"320",
                            "24":"320",
                            "25":"640",
                            "26":"1280",
                            "27":"640",
                            "28":"320",
                            "29":"320",
                            "30":"320",
                            "31":"320",
                            "32":"640",
                            "33":"640",
                            "34":"640"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"80",
                            "3":"80",
                            "4":"80",
                            "5":"80",
                            "6":"80",
                            "7":"160",
                            "8":"160",
                            "9":"160",
                            "10":"320",
                            "11":"320",
                            "12":"320",
                            "13":"640",
                            "14":"640",
                            "15":"640",
                            "16":"320",
                            "17":"320",
                            "18":"320",
                            "19":"160",
                            "20":"320",
                            "21":"160",
                            "22":"160",
                            "23":"160",
                            "24":"320",
                            "25":"320",
                            "26":"640",
                            "27":"1280",
                            "28":"640",
                            "29":"320",
                            "30":"320",
                            "31":"320",
                            "32":"320",
                            "33":"640",
                            "34":"640"
                        },
                        {
                            "0":"320",
                            "1":"160",
                            "2":"160",
                            "3":"160",
                            "4":"80",
                            "5":"80",
                            "6":"80",
                            "7":"80",
                            "8":"80",
                            "9":"160",
                            "10":"160",
                            "11":"160",
                            "12":"320",
                            "13":"320",
                            "14":"320",
                            "15":"640",
                            "16":"640",
                            "17":"640",
                            "18":"320",
                            "19":"320",
                            "20":"320",
                            "21":"320",
                            "22":"160",
                            "23":"160",
                            "24":"160",
                            "25":"320",
                            "26":"320",
                            "27":"640",
                            "28":"1280",
                            "29":"640",
                            "30":"640",
                            "31":"320",
                            "32":"320",
                            "33":"640",
                            "34":"640"
                        },
                        {
                            "0":"320",
                            "1":"320",
                            "2":"320",
                            "3":"160",
                            "4":"160",
                            "5":"160",
                            "6":"80",
                            "7":"80",
                            "8":"80",
                            "9":"80",
                            "10":"80",
                            "11":"160",
                            "12":"160",
                            "13":"160",
                            "14":"320",
                            "15":"320",
                            "16":"320",
                            "17":"640",
                            "18":"640",
                            "19":"640",
                            "20":"640",
                            "21":"320",
                            "22":"320",
                            "23":"160",
                            "24":"160",
                            "25":"160",
                            "26":"320",
                            "27":"320",
                            "28":"640",
                            "29":"1280",
                            "30":"640",
                            "31":"320",
                            "32":"320",
                            "33":"320",
                            "34":"640"
                        },
                        {
                            "0":"320",
                            "1":"320",
                            "2":"320",
                            "3":"320",
                            "4":"320",
                            "5":"320",
                            "6":"160",
                            "7":"160",
                            "8":"160",
                            "9":"160",
                            "10":"160",
                            "11":"160",
                            "12":"160",
                            "13":"160",
                            "14":"160",
                            "15":"320",
                            "16":"320",
                            "17":"320",
                            "18":"320",
                            "19":"320",
                            "20":"640",
                            "21":"640",
                            "22":"640",
                            "23":"320",
                            "24":"320",
                            "25":"320",
                            "26":"320",
                            "27":"320",
                            "28":"640",
                            "29":"640",
                            "30":"1280",
                            "31":"1280",
                            "32":"640",
                            "33":"640",
                            "34":"1280"
                        },
                        {
                            "0":"320",
                            "1":"320",
                            "2":"320",
                            "3":"320",
                            "4":"320",
                            "5":"320",
                            "6":"320",
                            "7":"320",
                            "8":"320",
                            "9":"320",
                            "10":"160",
                            "11":"160",
                            "12":"160",
                            "13":"160",
                            "14":"160",
                            "15":"160",
                            "16":"160",
                            "17":"160",
                            "18":"160",
                            "19":"320",
                            "20":"640",
                            "21":"640",
                            "22":"640",
                            "23":"640",
                            "24":"640",
                            "25":"320",
                            "26":"320",
                            "27":"320",
                            "28":"320",
                            "29":"320",
                            "30":"1280",
                            "31":"1280",
                            "32":"1280",
                            "33":"640",
                            "34":"640"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"160",
                            "3":"320",
                            "4":"320",
                            "5":"320",
                            "6":"320",
                            "7":"320",
                            "8":"320",
                            "9":"320",
                            "10":"320",
                            "11":"320",
                            "12":"320",
                            "13":"320",
                            "14":"160",
                            "15":"160",
                            "16":"160",
                            "17":"160",
                            "18":"160",
                            "19":"160",
                            "20":"320",
                            "21":"320",
                            "22":"640",
                            "23":"640",
                            "24":"640",
                            "25":"640",
                            "26":"640",
                            "27":"320",
                            "28":"320",
                            "29":"320",
                            "30":"640",
                            "31":"1280",
                            "32":"1280",
                            "33":"1280",
                            "34":"640"
                        },
                        {
                            "0":"160",
                            "1":"160",
                            "2":"160",
                            "3":"160",
                            "4":"160",
                            "5":"160",
                            "6":"160",
                            "7":"320",
                            "8":"320",
                            "9":"320",
                            "10":"320",
                            "11":"320",
                            "12":"320",
                            "13":"320",
                            "14":"320",
                            "15":"320",
                            "16":"320",
                            "17":"320",
                            "18":"160",
                            "19":"160",
                            "20":"320",
                            "21":"320",
                            "22":"320",
                            "23":"320",
                            "24":"640",
                            "25":"640",
                            "26":"640",
                            "27":"640",
                            "28":"640",
                            "29":"320",
                            "30":"640",
                            "31":"640",
                            "32":"1280",
                            "33":"1280",
                            "34":"1280"
                        },
                        {
                            "0":"320",
                            "1":"320",
                            "2":"160",
                            "3":"160",
                            "4":"160",
                            "5":"160",
                            "6":"160",
                            "7":"160",
                            "8":"160",
                            "9":"160",
                            "10":"160",
                            "11":"320",
                            "12":"320",
                            "13":"320",
                            "14":"320",
                            "15":"320",
                            "16":"320",
                            "17":"320",
                            "18":"320",
                            "19":"320",
                            "20":"640",
                            "21":"320",
                            "22":"320",
                            "23":"320",
                            "24":"320",
                            "25":"320",
                            "26":"640",
                            "27":"640",
                            "28":"640",
                            "29":"640",
                            "30":"1280",
                            "31":"640",
                            "32":"640",
                            "33":"1280",
                            "34":"128"
                        }
                    ]
                },
                "type":"antigenic"
            },
            "version":1
        },
            map: {
            "background":{
                "background_color":16777215,
                "borderline_color":null
            },
            "border_space":0.0,
            "center":[
                0.019784638491023188,
                -0.020333691886028404
            ],
            "diameter":[
                8.0,
                8.0
            ],
            "grid":{
                "step":1.0,
                "style":{
                    "version":1
                }
            },
            "layout":[
                [
                    -2.4222557773073325,
                    -0.3135975067547265
                ],
                [
                    -2.357981991205597,
                    0.43243753248662525
                ],
                [
                    -2.1788373914549286,
                    1.190983863536589
                ],
                [
                    -1.6372180068389501,
                    1.7484520546365079
                ],
                [
                    -1.0449994455089995,
                    2.203853303600885
                ],
                [
                    -0.31702022530164153,
                    2.371697713737634
                ],
                [
                    0.455471789666959,
                    2.436011723038462
                ],
                [
                    1.1525503071051812,
                    2.093710819466852
                ],
                [
                    1.768627359244586,
                    1.6717084497566321
                ],
                [
                    2.1532117195091423,
                    1.0315296186341398
                ],
                [
                    2.4531332099802228,
                    0.3169209282743665
                ],
                [
                    2.3433328278351806,
                    -0.44865802391785603
                ],
                [
                    2.1335386409981605,
                    -1.1645070078703614
                ],
                [
                    1.6459097338520332,
                    -1.7275923494937435
                ],
                [
                    1.0619468565470274,
                    -2.2344780268698705
                ],
                [
                    0.30194240144707635,
                    -2.369620257129427
                ],
                [
                    -0.44308776508131403,
                    -2.395540366512581
                ],
                [
                    -1.1331855838520775,
                    -2.1086495783313595
                ],
                [
                    -1.8022616346074198,
                    -1.7075415090902422
                ],
                [
                    -2.1694019517282936,
                    -1.0198406436272605
                ],
                [
                    -1.4260810547322023,
                    -0.18299838127704957
                ],
                [
                    -1.3026398539192672,
                    0.7149841408432389
                ],
                [
                    -0.6125023510219794,
                    1.2968255941805997
                ],
                [
                    0.2736851738058461,
                    1.4559055639594434
                ],
                [
                    1.0400281692806532,
                    0.9802775027137761
                ],
                [
                    1.4653349437937315,
                    0.18717375376055714
                ],
                [
                    1.2517780936913054,
                    -0.6847864907299033
                ],
                [
                    0.633593354212049,
                    -1.3343812298981699
                ],
                [
                    -0.2566212716325122,
                    -1.4077342003189708
                ],
                [
                    -1.078939071895938,
                    -1.022671981385709
                ],
                [
                    -0.5582642504746846,
                    -0.07111703585357558
                ],
                [
                    -0.23609903621426073,
                    0.5054351391941843
                ],
                [
                    0.4069553461165629,
                    0.38020647827967485
                ],
                [
                    0.4855148540774039,
                    -0.26627975018895206
                ],
                [
                    0.07782853687715124,
                    -0.5818347801356125
                ],
                [
                    -2.4100235940821952,
                    -0.3159903683062315
                ],
                [
                    -2.347316348385016,
                    0.4273273035608511
                ],
                [
                    -2.173406720879617,
                    1.1809337758894507
                ],
                [
                    -1.6357870452867942,
                    1.739130454049804
                ],
                [
                    -1.0460737885266762,
                    2.197357831188417
                ],
                [
                    -0.3192140552358601,
                    2.3685648787817373
                ],
                [
                    0.4544220275248414,
                    2.436207750284638
                ],
                [
                    1.1516350317292385,
                    2.097424281200176
                ],
                [
                    1.7699697253912101,
                    1.6781538453612337
                ],
                [
                    2.157910518090213,
                    1.0397064591316008
                ],
                [
                    2.4618250542893794,
                    0.32433361406507233
                ],
                [
                    2.355123912348379,
                    -0.4477416222559089
                ],
                [
                    2.145809955880507,
                    -1.1666902043134515
                ],
                [
                    1.6551047676978905,
                    -1.7340726361577044
                ],
                [
                    1.0645083804069952,
                    -2.242914819466897
                ],
                [
                    0.2957629168977161,
                    -2.375507709469048
                ],
                [
                    -0.4513646164061186,
                    -2.393994652183412
                ],
                [
                    -1.1368236857723835,
                    -2.100928661472568
                ],
                [
                    -1.7968277976689282,
                    -1.7005978270225321
                ],
                [
                    -2.1584878127710736,
                    -1.0171157508230246
                ],
                [
                    -1.4145564419922225,
                    -0.18684476438096623
                ],
                [
                    -1.2990152841167122,
                    0.7034200351177651
                ],
                [
                    -0.6161313975930088,
                    1.2895676137307506
                ],
                [
                    0.2702204746677093,
                    1.4565525887506525
                ],
                [
                    1.0392632224009406,
                    0.9883560472377472
                ],
                [
                    1.4728888373328084,
                    0.1966502552732685
                ],
                [
                    1.263914118470086,
                    -0.6853587502938636
                ],
                [
                    0.6371188203538156,
                    -1.343148186508563
                ],
                [
                    -0.26874846013631243,
                    -1.405469418845848
                ],
                [
                    -1.0724870775617348,
                    -1.0157682992729806
                ],
                [
                    -0.5488949205074238,
                    -0.07310226938581664
                ],
                [
                    -0.2423035475691902,
                    0.5014564897819715
                ],
                [
                    0.40260497976243276,
                    0.38615626885996945
                ],
                [
                    0.4949691684604566,
                    -0.267809847960047
                ],
                [
                    -0.28257597247622657,
                    -0.5145287648610501
                ]
            ],
            "number_of_antigens":35,
            "point_indices_per_page":{
                "-1":[],
                "0":null
            },
            "point_info":[
                {
                    "location":{},
                    "name":{
                        "name":"A1"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A2"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A3"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A4"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A5"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A6"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A7"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A8"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A9"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A10"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A11"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A12"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A13"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A14"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A15"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A16"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A17"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A18"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A19"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A20"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A21"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A22"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A23"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A24"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A25"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A26"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A27"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A28"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A29"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A30"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A31"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A32"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A33"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A34"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"A35"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S1"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S2"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S3"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S4"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S5"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S6"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S7"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S8"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S9"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S10"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S11"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S12"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S13"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S14"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S15"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S16"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S17"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S18"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S19"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S20"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S21"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S22"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S23"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S24"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S25"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S26"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S27"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S28"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S29"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S30"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S31"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S32"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S33"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S34"
                    }
                },
                {
                    "location":{},
                    "name":{
                        "name":"S35"
                    }
                }
            ],
            "scale":{
                "label_size_scale":1.0,
                "object_size_scale":1.0
            },
            "show_labels":false,
            "styles":{
                "drawing_order":[
                    [
                        35,
                        36,
                        37,
                        38,
                        39,
                        40,
                        41,
                        42,
                        43,
                        44,
                        45,
                        46,
                        47,
                        48,
                        49,
                        50,
                        51,
                        52,
                        53,
                        54,
                        55,
                        56,
                        57,
                        58,
                        59,
                        60,
                        61,
                        62,
                        63,
                        64,
                        65,
                        66,
                        67,
                        68,
                        69
                    ],
                    [
                        0,
                        1,
                        2,
                        3,
                        4,
                        5,
                        6,
                        7,
                        8,
                        9,
                        10,
                        11,
                        12,
                        13,
                        14,
                        15,
                        16,
                        17,
                        18,
                        19,
                        20,
                        21,
                        22,
                        23,
                        24,
                        25,
                        26,
                        27,
                        28,
                        29,
                        30,
                        31,
                        32,
                        33,
                        34
                    ]
                ],
                "points":[
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    1,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2,
                    2
                ],
                "styles":[
                    {
                        "aspect":1.0,
                        "fill_color":"#00ff00",
                        "label_version":1,
                        "outline_color":"#000000",
                        "rotation":0.0,
                        "shape":"circle",
                        "size":1.0,
                        "version":1
                    },
                    {
                        "aspect":1.0,
                        "fill_color":[
                            "#000000",
                            0.0
                        ],
                        "label_version":1,
                        "outline_color":"#000000",
                        "rotation":0.0,
                        "shape":"circle",
                        "size":1.5,
                        "version":1
                    },
                    {
                        "aspect":1.0,
                        "fill_color":[
                            "#000000",
                            0.0
                        ],
                        "label_version":1,
                        "outline_color":"#000000",
                        "rotation":0.0,
                        "shape":"box",
                        "size":1.5,
                        "version":1
                    }
                ]
            },
            "title":{
                "0":{
                    "offset":[
                        20,
                        20
                    ],
                    "style":{
                        "background":[
                            "#e0e0ff",
                            0.7490196078431373
                        ],
                        "border":{
                            "color":"#000080",
                            "version":1,
                            "width":1.0
                        },
                        "text":{
                            "color":"#0000ff",
                            "font_face":"sans-serif",
                            "font_slant":"normal",
                            "font_weight":"bold",
                            "rotation":0.0,
                            "size":1.0,
                            "version":1
                        },
                        "version":1
                    },
                    "text":null
                }
            },
            "transformation":[
                [
                    1.0,
                    0.0
                ],
                [
                    0.0,
                    -1.0
                ]
            ],
            "version":1,
            "viewport_origin":[
                -3.980215361508977,
                -4.020333691886028
            ],
            "viewport_size":[
                8.0,
                8.0
            ]
        }, active: true}
    ];

    $scope.open = function() {
        fileDialog.openFile($scope.handleFileOpen, false, '.xls,.xlsx,.txt,.save,.acd1,.acd1.bz2,.acd1.xz,.acp1,.acp1.bz2,.acp1.xz');
    };

    $scope.handleFileOpen = function(filename) {
        var fs = require('fs');
        //console.log('orginal-'+filename);
        var api = require('./app/shared/api.js');
        if(!fs.existsSync(config.api.path))
        {
            var output = api.stub();
        } else {
            var output = api.import_user_data(filename, 'new-open');
        }

        var output_acd1 = output.output_acd1;
        // parse file returned from table_filename to get json data related with table. NOTE: this file can only be json.
        var table_filename = output.table_json;
        // parse file returned from map_filename to get json data related with maps. NOTE: this file can only be json.
        var map_filename = output.map_json;

        var numOpenMaps = $scope.openMaps.length;
        $scope.openMaps[numOpenMaps] = {};

        fs.readFile(table_filename, 'utf8', function (err,data) {
            if (err) {
                return console.log(err);
            }
            data = data.substring(data.indexOf("{")-1);
            var mapJsonData = data.replace(/\'/g, '"').replace(/None/g, 'null').replace(/True/g, 'true').replace(/False/g, 'false')
                .replace(/[0-9]{1,5}:/g, function(match){return '"' + match.replace(':','') + '":';}); //For the bad formated acd1 files...
            $scope.openMaps[numOpenMaps].table = JSON.parse(mapJsonData);
        });

        fs.readFile(map_filename, 'utf8', function (err,data) {
            if (err) {
                return console.log(err);
            }
            data = data.substring(data.indexOf("{")-1);
            var mapJsonData = data.replace(/\'/g, '"').replace(/None/g, 'null').replace(/True/g, 'true').replace(/False/g, 'false')
                .replace(/[0-9]{1,5}:/g, function(match){return '"' + match.replace(':','') + '":';}); //For the bad formated acd1 files...

            $scope.openMaps[numOpenMaps].map = JSON.parse(mapJsonData);
            $scope.openMaps[numOpenMaps].title = $scope.openMaps[numOpenMaps].table.info.name;
            $scope.$apply();
        });


        /*
        // old .acd1
        fs.readFile(filename, 'utf8', function (err,data) {
            if (err) {
                return console.log(err);
            }
            data = data.substring(data.indexOf("{")-1);
            var mapJsonData = data.replace(/\'/g, '"').replace(/None/g, 'null').replace(/True/g, 'true').replace(/False/g, 'false')
                .replace(/[0-9]{1,5}:/g, function(match){return '"' + match.replace(':','') + '":';}); //For the bad formated acd1 files...
            $scope.openMaps.push({title:filename, content: JSON.parse(mapJsonData), active: true});

            $scope.$apply();
        });*/
    };

    $scope.handleFileSave = function(filename) {
        var fs = require('fs');
        fs.writeFile(filename, $scope.fileContent, function (err) {
            if (err) return console.log(err);
        });
    };
}]);